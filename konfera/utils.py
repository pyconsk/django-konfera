from decimal import Decimal, ROUND_UP

from konfera.models.order import Order
from konfera.settings import GOOGLE_ANALYTICS, NAVIGATION_ENABLED, NAVIGATION_URL, NAVIGATION_LOGO, NAVIGATION_BRAND


def collect_view_data(request):
    """
    Function collects view_data generated by other functions
    """
    view_data = dict()
    view_data['navigation_enabled'] = NAVIGATION_ENABLED
    view_data['navigation_url'] = NAVIGATION_URL
    view_data['navigation_brand'] = NAVIGATION_BRAND
    view_data['navigation_logo'] = NAVIGATION_LOGO

    if GOOGLE_ANALYTICS:
        view_data['ga'] = GOOGLE_ANALYTICS

    return view_data


def update_order_status_context(status, context):
    if status == Order.PAID:
        context['status_label'] = 'label-success'
    elif status in [Order.CANCELLED, Order.EXPIRED]:
        context['status_label'] = 'label-danger'
    else:
        context['status_label'] = 'label-warning'


def update_event_context(event, context, show_sponsors=True):
    context['event'] = event

    if show_sponsors:
        context['sponsors'] = event.sponsors.all().order_by('type', 'title')

    if event.analytics:
        context['ga'] = event.analytics


def currency_round_up(money):
    return money.quantize(Decimal('1.00'), rounding=ROUND_UP)
